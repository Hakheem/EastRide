generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// Enums
enum UserRole { 
  USER
  ADMIN
  SUPERADMIN
}

enum CarStatus {
  AVAILABLE
  UNAVAILABLE
  SOLD
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

// User model
model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  email         String    @unique
  emailVerified DateTime? 
  name          String?
  image         String?
  role          UserRole  @default(USER)

  // Relations
  accounts          Account[]
  sessions          Session[]
  savedCars         UserSavedCar[]
  testDriveBookings TestDriveBooking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Account model (for OAuth providers)
model Account {
  id                String  @id @default(auto()) @map("_id") @db.ObjectId
  userId            String  @db.ObjectId
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.String
  access_token      String? @db.String
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.String
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

// Session model
model Session {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken String   @unique
  userId       String   @db.ObjectId
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// Verification token model
model VerificationToken {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// Car model
model Car {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  make         String
  model        String
  year         Int
  price        Float
  mileage      Int
  color        String
  fuelType     String
  transmission String
  bodyType     String
  seats        Int?
  description  String?
  status       CarStatus  @default(AVAILABLE)
  featured     Boolean    @default(false)
  images       String[]

  // Relations
  savedBy           UserSavedCar[]
  testDriveBookings TestDriveBooking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([make])
  @@index([model])
  @@index([bodyType])
  @@index([price])
  @@index([year])
  @@index([status])
  @@index([fuelType])
  @@index([featured])
}

// User Saved Cars model
model UserSavedCar {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  carId  String @db.ObjectId

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  car  Car  @relation(fields: [carId], references: [id], onDelete: Cascade)

  savedAt DateTime @default(now())

  @@unique([userId, carId])
  @@index([userId])
  @@index([carId])
}

// Test Drive Booking model
model TestDriveBooking {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  carId       String        @db.ObjectId
  userId      String        @db.ObjectId
  bookingDate DateTime      @db.Date
  startTime   String
  endTime     String
  status      BookingStatus @default(PENDING)
  notes       String?

  car  Car  @relation(fields: [carId], references: [id])
  user User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([carId])
  @@index([userId])
  @@index([status])
}

// Dealership Info model
model DealershipInfo {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  name    String @default("East Africa Rides")
  address String @default("35/60 Nairobi Kenya")
  phone   String @default("+254769403162")
  email   String @default("hakheem67@gmail.com")

  // Relations
  workingHours WorkingHours[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Working Hours model
model WorkingHours {
  id            String       @id @default(auto()) @map("_id") @db.ObjectId
  dealershipId  String       @db.ObjectId
  dayOfWeek     DayOfWeek
  openTime      String // Format: HH:MM (24-hour)
  closeTime     String // Format: HH:MM (24-hour)
  isOpen        Boolean      @default(true)

  dealership DealershipInfo @relation(fields: [dealershipId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([dealershipId, dayOfWeek])
  @@index([dealershipId])
  @@index([dayOfWeek])
  @@index([isOpen])
}

model ContactSubmission {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String
  phone         String
  subject       String
  message       String
  contactMethod String
  inquiryType   String
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

